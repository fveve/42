Language: Markdown

Additional service : jekyll

Pourquoi les dÃ©veloppeurs utilisent Docker ? ğŸ¤”

Le grand avantage de Docker est la possibilitÃ© de modÃ©liser chaque conteneur sous la forme d'une image que l'on peut stocker localement.


ğŸ” Un conteneur est une machine virtuelle sans noyau.

ğŸ“Œ Ce que jâ€™appelle noyau est tout lâ€™ensemble du systÃ¨me permettant Ã  la machine virtuelle de fonctionner, lâ€™OS, le cotÃ© graphique, rÃ©seau, etcâ€¦

ğŸ” En dâ€™autres termes, un conteneur ne contient que lâ€™application et les dÃ©pendances de lâ€™application.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


						FROM		alpine:3.12

						RUN			apk update && apk upgrade && apk add	\
													openssl			\
													nginx			\
													curl			\
													vim				\
													sudo

						RUN			rm -f /etc/nginx/nginx.conf

						COPY		./config/nginx.conf /etc/nginx/nginx.conf
						COPY		scripts/setup_nginx.sh /setup_nginx.sh

						RUN			chmod -R +x /setup_nginx.sh

						EXPOSE		443

						ENTRYPOINT	["sh", "setup_nginx.sh"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Quelques mots-clefs Dockerfile:
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
Permet dâ€™indiquer Ã  Docker sous quel OS doit tourner votre machine virtuelle.

Câ€™est le premier mot clef de votre Dockerfile et celui ci est obligatoire.

Les plus courants sont debian:buster pour Debian ou alpine:x:xx pour Linux.

RUN
Permet de lancer une commande sur votre machine virtuelle

ğŸ’¡
Lâ€™Ã©quivalent de se connecter en ssh, puis de taper une commande bash, comme : echo â€œHello World!â€, qui afficheraâ€¦.
En gÃ©nÃ©ral, les premiers RUN fournit dans le Dockerfile consistent Ã  mettre Ã  jour les ressources de votre VM, comme apk, ou encore dâ€™ajouter les utilitaires basiques comme vim, curl ou sudo.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

COPY
Vous lâ€™avez ! Cela permet en effet de copier un fichier.

Le copier ? Ã€ partir dâ€™ou ?
Vous indiquez simplement ou se trouve votre fichier Ã  copier Ã  partir du rÃ©pertoire ou se trouve votre Dockerfile, puis la ou vous souhaitez le copier dans votre machine virtuelle.

ğŸ’¡
Une image docker câ€™est un dossier, il contient obligatoirement votre Dockerfile Ã  la racine du dossier mais peut aussi contenir un tas dâ€™autres fichiers pour ensuite pouvoir les copier directement dans votre VM.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

EXPOSE
Ici, câ€™est une question de rÃ©seau ğŸ“¡

L'instruction EXPOSE informe Docker que le conteneur Ã©coute sur les ports rÃ©seaux spÃ©cifiÃ©s au moment de l'exÃ©cution. EXPOSE ne rend pas les ports du conteneur accessibles Ã  l'hÃ´te.

Attendez ! Quoi ? Le conteneur Ã©coute sur le port rÃ©seau et n'est pas accessible Ã  l'hÃ´te ?

Qu'est-ce que cela signifie ? ğŸ˜£

L'instruction EXPOSE expose le port spÃ©cifiÃ© et le rend disponible uniquement pour la communication entre conteneurs. Comprenons cela Ã  l'aide d'un exemple.

Disons que nous avons deux conteneurs, une application wordpress et un serveur mariadb. Notre application wordpress a besoin de communiquer avec le serveur mariadb pour plusieurs raisons.


Pour que l'application WordPress puisse parler au serveur MariaDB, le conteneur WordPress doit exposer le port. Jetez un Å“il au Dockerfile de l'image officielle de wordpress et vous verrez une ligne disant EXPOSE3306. C'est ce qui aide les deux conteneurs Ã  communiquer l'un avec l'autre.

Ainsi, lorsque votre conteneur WordPress essaie de se connecter au port 3306 du conteneur MariaDB, c'est l'instruction EXPOSE qui rend cela possible.

Note : Pour que le serveur WordPress puisse communiquer avec le conteneur MariaDB, il est important que les deux conteneurs soient exÃ©cutÃ©s dans le mÃªme rÃ©seau docker.
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ENTRYPOINT
Youpi ! Votre container semble prÃªt Ã  dÃ©marrer.

Cependant il serait surement plus judicieux de demander au container de lancer une certaine commande au lancement de celui-ci.

Câ€™est ce que permet de faire le mot-clef ENTRYPOINT !

Il suffit dâ€™indiquer votre commande, argument par argument, dans le format suivant :

[ENTRYPOINT â€œbashâ€ , â€-câ€, â€œ"$(curl https://grademe.fr )"â€ ]

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Docker-Compose :
Maintenant que vous avez compris la rÃ©elle utilitÃ© de Docker, il sâ€™agit de comprendre une fonctionnalitÃ© de Docker appelÃ©e Compose.


ğŸ“„ Voici ce quâ€™explique la doc de Docker sur Compose:

Docker Compose est un outil qui a Ã©tÃ© dÃ©veloppÃ© pour aider Ã  dÃ©finir et Ã  partager des applications multi-conteneurs.
Avec Compose, nous pouvons crÃ©er un fichier YAML pour dÃ©finir les services et, Ã  l'aide d'une seule commande, tout mettre en route ou tout dÃ©monter.

ğŸ’¡
Compose permettrait donc de gÃ©rer des applications qui utilisent plusieurs containers et de communiquer entre eux.

Maintenant câ€™est certain, le projet consiste Ã  relier plusieurs image Docker, et pouvoir les lancer ensemble, sans pour autant, quâ€™elles perdent leur indÃ©pendance.

Tout ca grace Ã  Docker-Compose qui est prÃ©vu pour ce genre dâ€™utilisation.

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Les volumes Compose prÃ©sentent plusieurs avantages comme pouvoir Ãªtre gÃ©rÃ©s Ã  l'aide des commandes de la CLI de Docker ou de son API ou encore pouvoir Ãªtre partagÃ©s de maniÃ¨re plus sÃ»re entre plusieurs conteneurs.

+ dâ€™info sur la doc de Docker ici
https://docs.docker.com/storage/volumes/

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Les commandes essentielles dâ€™un container Docker :

Un container Docker doit Ãªtre build avant dâ€™Ãªtre lancÃ©.

Câ€™est pendant le build que vous pourrez obtenir des infos sur des potentielles erreurs que vous auriez fait dans le Dockerfile.

ğŸ’¡
Chaque commande Docker commence par le mot clef docker

Build un container Docker :     docker build

Un container Docker doit Ãªtre build avant dâ€™Ãªtre lancÃ©.

Câ€™est pendant le build que vous pourrez obtenir des infos sur des potentielles erreurs que vous auriez fait dans le Dockerfile.

ğŸ’¡
Chaque commande Docker commence par le mot clef docker

Build un container Docker :     docker build

ğŸ˜µ J'espÃ¨re que vous nâ€™oseriez pas tenter cette commande sans lâ€™avoir parfaitement comprise !

ğŸ¤ª De toute maniÃ¨re, la commande nâ€™est pas fonctionnelle, docker demande obligatoirement un chemin ou se trouve le Dockerfile de lâ€™image Ã  build.

Dans notre cas, ce serait docker build srcs/requirements/nginx/

Ou encore plus simple, docker build . en vous trouvant directement dans le dossier NGINX.

Vous pouvez Ã©galement prÃ©ciser un nom Ã  votre build, avec le flag -t

Exemple : docker build -t nginx .

ğŸ’¡
Si vous obtenez une erreur de type Cannot connect to the Docker daemon, vÃ©rifiez que Docker est bien ouvert et quâ€™il fonctionne.

Connaitre les images actuelles (aprÃ¨s un build rÃ©ussi) :    docker image ls

ğŸ¥³ Vous devriez visualiser votre premiÃ¨re image !

ğŸ˜• Cependant celle ci nâ€™a pas de nom en dessous de REPOSITORY, il est indiquÃ© <none>, meme si on peut relier cette image Ã  son ID prÃ©sent dans la quatriÃ¨me colonne, le sujet nous demande que le nom de lâ€™image porte le nom du container associÃ©, ici NGINX.

Et on peut faire cela ! Il suffit simplement de prÃ©ciser quand on build lâ€™image, son nom, grace au flag -t

DÃ©marrer une image (run) :     docker run <image_name>

ğŸ“Œ Vous devrez indiquer le nom de votre image Ã  run.

ğŸ‘‰ En prÃ©cisant -it avant le nom de votre image, vous accÃ©derez directement au terminal de votre container Ã  son lancement.

Connaitre les containers actuellement lancÃ©s :     docker ps

ğŸ‘‰ Vous pouvez mÃªme obtenir les containers Docker stoppÃ©s en rajoutant le flag -a

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

docker run -it --rm <name> /bin/bash
